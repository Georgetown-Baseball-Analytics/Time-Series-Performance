) %>%
mutate( # this is what changes for slugging and OBP
obp_bin = case_when(
pa_outcome %in% c(
"Single",
"Double",
"Home Run",
"Walk"
) ~ 1,
pa_outcome %in% c(
"Flyout",
"Strikeout",
"Groundout",
"Lineout",
"Lined Into Double Play"
) ~ 0,
TRUE ~ NA_real_
# do this for all
)
)
d_obp_collapsed <- d_obp %>%
group_by(pitch_group) %>%
summarize(
Outcome = mean(obp_bin, na.rm = T),
Name = ".OBP"
)
dpitchperf <- rbind(d_ba_collapsed, d_slg_collapsed, d_obp_collapsed)
ggplot(dpitchperf, aes(x = pitch_group, y = Outcome, group = Name, color = Name)) +
geom_point() +
geom_line()
#source("Kishor import.R")
library(tidyverse)
d <- read_csv("../data/tonas_clean.csv")
View(d)
d <- d %>%
mutate(
strike = case_when(
pitch_result %in% c("Strike Swinging", "Strike Taken", "Foul", "BIP") ~ 1,
TRUE ~ 0
)) %>%
group_by(outing_id) %>%
mutate(
pitch_num_by_outing = row_number()) %>%
ungroup() %>%
mutate(
pitch_group_by_ten = (pitch_num_by_outing %/% 10) + 1,
pg_b = pitch_group_by_ten * 10,
pg_a = pg_b - 9,
pitch_group = str_c(pg_a, pg_b, sep = "-")
)
View(d)
View(d)
(100 %/% 10) + 1
library(tidyverse)
library(rio)
library(janitor)
import_data <- function() {
d <- read_csv("../data/Tonas 2019-2021.csv")
d <- clean_names(d)
return(d)
}
clean_inning <- function(d) {
if (any(str_length(d$inning) < 2) | any(str_length(d$inning) > 3)) {
print("Check inning variable - string length less than 2 or greater than 3")
}
d <- d %>%
mutate(
top_or_bottom_letter = str_remove_all(inning, "[0-9]"),
top_of_frame = if_else(top_or_bottom_letter == "T", 1, 0),
inning_num = str_remove_all(inning, "[^0-9]")
)
}
clean_count <- function(d) {
d <- d %>%
separate("count", into = c("balls", "strikes"), sep = "-", convert = TRUE)
return(d)
}
add_outing_id <- function(d) {
d <- d %>%
mutate(outing_id = 1)
cur_outing <- d$notes[1]
cur_outing_num <- 1
for (i in seq_along(d$notes)) {
if (d$notes[i] == cur_outing) {
d$outing_id[i] <- cur_outing_num
}
else {
cur_outing_num <- cur_outing_num + 1
d$outing_id[i] <- cur_outing_num
cur_outing <- d$notes[i]
}
}
return(d)
# does not work if pitcher pitches in multiple consecutive games against the same opponent
}
add_pa_id <- function(d) {
add_pa_id_by_outing <- function(df) {
df <- df %>%
mutate(pa_id = 1)
cur_pa <- df$title[1]
cur_pa_num <- 1
for (i in seq_along(df$title)) {
if (df$title[i] == cur_pa) {
df$pa_id[i] <- cur_pa_num
}
else {
cur_pa_num <- cur_pa_num + 1
df$pa_id[i] <- cur_pa_num
cur_pa <- df$title[i]
}
}
return(df)
}
d <- d %>%
group_by(outing_id) %>%
nest()
d$data <- map(d$data, add_pa_id_by_outing)
d <- d %>%
unnest(cols = data)
return(d)
}
clean_result <- function(d) {
d <- d %>%
mutate(
non_bip_result_clean = str_remove_all(non_bip_result, ","),
non_bip_result = if_else(non_bip_result_clean == "", NA_character_, non_bip_result_clean)
) %>%
select(-non_bip_result_clean)
return(d)
}
clean_data_pipeline <- function(d) {
d <- d %>%
clean_names() %>%
clean_inning() %>%
clean_count() %>%
add_outing_id() %>%
add_pa_id() %>%
clean_result()
return(d)
}
export_data <- function(d) {
rio::export(d, "../data/tonas2019-2021_clean.csv")
}
d <- import_data() %>% clean_data_pipeline() %>% export_data()
d <- read_csv("../data/tonas2019-2021_clean.csv")
d <- d %>%
mutate(
strike = case_when(
pitch_result %in% c("Strike Swinging", "Strike Taken", "Foul", "BIP") ~ 1,
TRUE ~ 0
)) %>%
group_by(outing_id) %>%
mutate(
pitch_num_by_outing = row_number()) %>%
ungroup() %>%
mutate(
pitch_group_by_ten = (pitch_num_by_outing %/% 10) + 1,
pg_b = pitch_group_by_ten * 10,
pg_a = pg_b - 9,
pitch_group = str_c(pg_a, pg_b, sep = "-")
)
dd <- d %>%
group_by(pitch_group) %>%
summarize(
strike_pct = mean(strike),
count = n(),
)
pitcher <- unique(d$pitcher)
ggplot(dd) +
geom_point(aes(x = pitch_group, y = strike_pct)) +
geom_line(aes(x = pitch_group, y = strike_pct, group = 1)) +
scale_y_continuous(labels = scales::percent) +
labs(title = paste(pitcher, "Strike % by Pitch Count"), y = "Strike Percentage", x = "Pitch Number") +
theme_bw()
View(dd)
View(d)
d <- read_csv("../data/tonas2019-2021_clean.csv")
d <- d %>%
group_by(outing_id) %>%
mutate(
pitch_num_by_outing = row_number()) %>%
ungroup() %>%
mutate(
pitch_group_by_ten = (pitch_num_by_outing %/% 10) + 1,
pg_b = pitch_group_by_ten * 10,
pg_a = pg_b - 9,
pitch_group = str_c(pg_a, pg_b, sep = "-")
)
View(d)
dd <- d %>%
mutate(
strike = case_when(
pitch_result %in% c("Strike Swinging", "Strike Taken", "Foul", "BIP") ~ 1,
TRUE ~ 0
)) 	 %>%
group_by(pitch_group) %>%
summarize(
strike_pct = mean(strike),
count = n(),
)
pitcher <- unique(d$pitcher)
ggplot(dd) +
geom_point(aes(x = pitch_group, y = strike_pct)) +
geom_line(aes(x = pitch_group, y = strike_pct, group = 1)) +
scale_y_continuous(labels = scales::percent) +
labs(title = paste(pitcher, "Strike % by Pitch Count"), y = "Strike Percentage", x = "Pitch Number") +
theme_bw()
#source("Kishor import.R")
library(tidyverse)
#source("import_synergy_data.R")
library(tidyverse)
d <- read_csv("../data/tonas2019-2021_clean.csv")
d <- d %>%
group_by(outing_id) %>%
mutate(
pitch_num_by_outing = row_number()) %>%
ungroup() %>%
mutate(
pitch_group_by_ten = (pitch_num_by_outing %/% 10) + 1,
pg_b = pitch_group_by_ten * 10,
pg_a = pg_b - 9,
pitch_group = str_c(pg_a, pg_b, sep = "-")
)
d_strikepct <- d %>%
mutate(
strike = case_when(
pitch_result %in% c("Strike Swinging", "Strike Taken", "Foul", "BIP") ~ 1,
TRUE ~ 0
)) 	 %>%
group_by(pitch_group) %>%
summarize(
strike_pct = mean(strike),
count = n(),
)
pitcher <- unique(d$pitcher)
ggplot(dd) +
geom_point(aes(x = pitch_group, y = strike_pct)) +
geom_line(aes(x = pitch_group, y = strike_pct, group = 1)) +
scale_y_continuous(labels = scales::percent) +
labs(title = paste(pitcher, "Strike % by Pitch Count"), y = "Strike Percentage", x = "Pitch Number") +
theme_bw()
d <- d %>%
mutate(
strikeout = case_when(
non_bip_result %in% c("Strikeout") ~ 1,
TRUE ~ 0
)) %>%
mutate(
walk = case_when(
non_bip_result %in% c("Walk") ~ 1,
TRUE ~ 0
))
dk <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(strikeout),
Name = "strikeout"
)
#source("import_synergy_data.R")
library(tidyverse)
d <- read_csv("../data/tonas2019-2021_clean.csv")
d <- d %>%
group_by(outing_id) %>%
mutate(
pitch_num_by_outing = row_number()) %>%
ungroup() %>%
mutate(
pitch_group_by_ten = (pitch_num_by_outing %/% 10) + 1,
pg_b = pitch_group_by_ten * 10,
pg_a = pg_b - 9,
pitch_group = str_c(pg_a, pg_b, sep = "-")
)
d_strikepct <- d %>%
mutate(
strike = case_when(
pitch_result %in% c("Strike Swinging", "Strike Taken", "Foul", "BIP") ~ 1,
TRUE ~ 0
)) 	 %>%
group_by(pitch_group) %>%
summarize(
strike_pct = mean(strike),
count = n(),
)
pitcher <- unique(d$pitcher)
ggplot(dd) +
geom_point(aes(x = pitch_group, y = strike_pct)) +
geom_line(aes(x = pitch_group, y = strike_pct, group = 1)) +
scale_y_continuous(labels = scales::percent) +
labs(title = paste(pitcher, "Strike % by Pitch Count"), y = "Strike Percentage", x = "Pitch Number") +
theme_bw()
#source("import_synergy_data.R")
library(tidyverse)
d <- read_csv("../data/tonas2019-2021_clean.csv")
d <- d %>%
group_by(outing_id) %>%
mutate(
pitch_num_by_outing = row_number()) %>%
ungroup() %>%
mutate(
pitch_group_by_ten = (pitch_num_by_outing %/% 10) + 1,
pg_b = pitch_group_by_ten * 10,
pg_a = pg_b - 9,
pitch_group = str_c(pg_a, pg_b, sep = "-")
)
d_strikepct <- d %>%
mutate(
strike = case_when(
pitch_result %in% c("Strike Swinging", "Strike Taken", "Foul", "BIP") ~ 1,
TRUE ~ 0
)) 	 %>%
group_by(pitch_group) %>%
summarize(
strike_pct = mean(strike),
count = n(),
)
pitcher <- unique(d$pitcher)
ggplot(d_strikepct) +
geom_point(aes(x = pitch_group, y = strike_pct)) +
geom_line(aes(x = pitch_group, y = strike_pct, group = 1)) +
scale_y_continuous(labels = scales::percent) +
labs(title = paste(pitcher, "Strike % by Pitch Count"), y = "Strike Percentage", x = "Pitch Number") +
theme_bw()
d <- d %>%
mutate(
strikeout = case_when(
non_bip_result %in% c("Strikeout") ~ 1,
TRUE ~ 0
)) %>%
mutate(
walk = case_when(
non_bip_result %in% c("Walk") ~ 1,
TRUE ~ 0
))
dk <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(strikeout),
Name = "strikeout"
)
dbb <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(walk),
Name = "walk"
)
ddd <- rbind(dk, dbb)
ggplot(ddd, aes(x = pitch_group, y = Outcome, group = Name, color = Name)) +
geom_point() +
geom_line()
d_ba <- d %>%
group_by(outing_id, pa_id) %>%
summarize(no_result = sum(!is.na(bip_result)) + sum(!is.na(non_bip_result)))
View(dbb)
dk <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(strikeout),
Name = "strikeout"
)
dbb <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(walk),
Name = "walk"
)
d_ksandbbs <- rbind(dk, dbb)
ggplot(d_ksandbbs, aes(x = pitch_group, y = Outcome, group = Name, color = Name)) +
geom_point() +
geom_line()
d_ba <- d %>%
group_by(outing_id, pa_id) %>%
summarize(no_result = sum(!is.na(bip_result)) + sum(!is.na(non_bip_result)))
assertthat::assert_that(all(d_ba$no_result == 1))
d_ba <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate( # this is what changes for slugging and OBP
ba_bin = case_when(
pa_outcome %in% c(
"Single",
"Double",
"Home Run"
) ~ 1,
pa_outcome %in% c(
"Flyout",
"Strikeout",
"Groundout",
"Lineout",
"Lined Into Double Play"
) ~ 0,
pa_outcome == "Walk" ~ NA_real_,
TRUE ~ NA_real_
# do this for all
)
)
d_ba_collapsed <- d_ba %>%
group_by(pitch_group) %>%
summarize(
Outcome = mean(ba_bin, na.rm = T),
Name = ".AVG"
)
d_slg <- d %>%
group_by(outing_id, pa_id) %>%
summarize(no_result = sum(!is.na(bip_result)) + sum(!is.na(non_bip_result)))
assertthat::assert_that(all(d_slg$no_result == 1))
d_slg <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate(
single_bin = case_when(
pa_outcome %in% c("Single") ~ 1,
TRUE ~ 0),
double_bin = case_when(
pa_outcome %in% c("Double") ~ 1,
TRUE ~ 0),
triple_bin = case_when(
pa_outcome %in% c("Triple") ~ 1,
TRUE ~ 0),
hr_bin = case_when(
pa_outcome %in% c("Home Run") ~ 1,
TRUE ~ 0),
at_bat = case_when(
pa_outcome %in% c("Walk", "Sacrifice Bunt") ~ 0,
TRUE ~ 1)
)
d_slg_collapsed <- d_slg %>%
group_by(pitch_group) %>%
summarize(
Outcome = (sum(single_bin) + 2*sum(double_bin) + 3*sum(triple_bin) + 4*sum(hr_bin))/sum(at_bat),
Name = ".SLG"
)
d_obp <- d %>%
group_by(outing_id, pa_id) %>%
summarize(no_result = sum(!is.na(bip_result)) + sum(!is.na(non_bip_result)))
assertthat::assert_that(all(d_obp$no_result == 1))
d_obp <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate( # this is what changes for slugging and OBP
obp_bin = case_when(
pa_outcome %in% c(
"Single",
"Double",
"Home Run",
"Walk"
) ~ 1,
pa_outcome %in% c(
"Flyout",
"Strikeout",
"Groundout",
"Lineout",
"Lined Into Double Play"
) ~ 0,
TRUE ~ NA_real_
# do this for all
)
)
d_obp_collapsed <- d_obp %>%
group_by(pitch_group) %>%
summarize(
Outcome = mean(obp_bin, na.rm = T),
Name = ".OBP"
)
dpitchperf <- rbind(d_ba_collapsed, d_slg_collapsed, d_obp_collapsed)
ggplot(dpitchperf, aes(x = pitch_group, y = Outcome, group = Name, color = Name)) +
geom_point() +
geom_line()
d_strikepct_innings <- d %>%
mutate(
strike = case_when(
pitch_result %in% c("Strike Swinging", "Strike Taken", "Foul", "BIP") ~ 1,
TRUE ~ 0
)) 	 %>%
group_by(inning_num) %>%
summarize(
strike_pct = mean(strike),
count = n(),
)
pitcher <- unique(d$pitcher)
ggplot(d_strikepct_innings) +
geom_point(aes(x = pitch_group, y = strike_pct)) +
geom_line(aes(x = pitch_group, y = strike_pct, group = 1)) +
scale_y_continuous(labels = scales::percent) +
labs(title = paste(pitcher, "Strike % by Pitch Count"), y = "Strike Percentage", x = "Pitch Number") +
theme_bw()
ggplot(d_strikepct_innings) +
geom_point(aes(x = inning_num, y = strike_pct)) +
geom_line(aes(x = inning_num, y = strike_pct, group = 1)) +
scale_y_continuous(labels = scales::percent) +
labs(title = paste(pitcher, "Strike % by Pitch Count"), y = "Strike Percentage", x = "Pitch Number") +
theme_bw()
ggplot(d_strikepct_innings) +
geom_point(aes(x = inning_num, y = strike_pct)) +
geom_line(aes(x = inning_num, y = strike_pct, group = 1)) +
scale_y_continuous(labels = scales::percent) +
labs(title = paste(pitcher, "Strike % by Pitch Count"), y = "Strike Percentage", x = "Inning Number") +
theme_bw()
ggplot(d_strikepct_innings) +
geom_point(aes(x = inning_num, y = strike_pct)) +
geom_line(aes(x = inning_num, y = strike_pct, group = 1)) +
scale_y_continuous(labels = scales::percent) +
labs(title = paste(pitcher, "Strike % by Inning"), y = "Strike Percentage", x = "Inning Number") +
theme_bw()
