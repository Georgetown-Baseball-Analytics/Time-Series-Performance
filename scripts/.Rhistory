labs(title = paste(pitcher, "Strike % by Pitch Count"), y = "Strike Percentage", x = "Pitch Number") +
theme_bw()
d <- d %>%
mutate(
strikeout = case_when(
non_bip_result %in% c("Strikeout,") ~ 1,
TRUE ~ 0
)) %>%
mutate(
walk = case_when(
non_bip_result %in% c("Walk,") ~ 1,
TRUE ~ 0
))
dk <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(strikeout),
Name = "Strikeout"
)
dbb <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(walk),
Name = "Walk"
)
ddd <- rbind(dk, dbb)
ggplot(ddd, aes(x = pitch_group, y = Outcome, group = Name, color = Name)) +
geom_point() +
geom_line()
View(dbb)
View(d)
d <- d %>%
mutate(
strikeout = case_when(
non_bip_result %in% c("Strikeout,") ~ 1,
TRUE ~ 0
)) %>%
mutate(
walk = case_when(
non_bip_result %in% c("Walk,") ~ 1,
TRUE ~ 0
))
dk <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(strikeout),
Name = "strikeout"
)
dbb <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(walk),
Name = "walk"
)
ddd <- rbind(dk, dbb)
ggplot(ddd, aes(x = pitch_group, y = Outcome, group = Name, color = Name)) +
geom_point() +
geom_line()
View(dbb)
d <- d %>%
mutate(
strikeout = case_when(
non_bip_result %in% c("strikeout,") ~ 1,
TRUE ~ 0
)) %>%
mutate(
walk = case_when(
non_bip_result %in% c("walk,") ~ 1,
TRUE ~ 0
))
dk <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(strikeout),
Name = "strikeout"
)
dbb <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(walk),
Name = "walk"
)
ddd <- rbind(dk, dbb)
ggplot(ddd, aes(x = pitch_group, y = Outcome, group = Name, color = Name)) +
geom_point() +
geom_line()
View(dbb)
View(d)
d <- d %>%
mutate(
strikeout = case_when(
non_bip_result %in% c("strikeout,") ~ 1,
TRUE ~ 0
)) %>%
mutate(
walk = case_when(
non_bip_result %in% c("walk,") ~ 1,
TRUE ~ 0
))
View(d)
d <- d %>%
mutate(
strikeout = case_when(
non_bip_result %in% c("strikeout") ~ 1,
TRUE ~ 0
)) %>%
mutate(
walk = case_when(
non_bip_result %in% c("walk") ~ 1,
TRUE ~ 0
))
dk <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(strikeout),
Name = "strikeout"
)
dbb <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(walk),
Name = "walk"
)
ddd <- rbind(dk, dbb)
ggplot(ddd, aes(x = pitch_group, y = Outcome, group = Name, color = Name)) +
geom_point() +
geom_line()
View(d)
d <- d %>%
mutate(
strikeout = case_when(
non_bip_result %in% c("Strikeout") ~ 1,
TRUE ~ 0
)) %>%
mutate(
walk = case_when(
non_bip_result %in% c("Walk") ~ 1,
TRUE ~ 0
))
dk <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(strikeout),
Name = "strikeout"
)
dbb <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(walk),
Name = "walk"
)
ddd <- rbind(dk, dbb)
ggplot(ddd, aes(x = pitch_group, y = Outcome, group = Name, color = Name)) +
geom_point() +
geom_line()
d_ba <- d %>%
group_by(outing_id, pa_id) %>%
summarize(no_result = sum(!is.na(bip_result)) + sum(!is.na(non_bip_result)))
assertthat::assert_that(all(d_ba$no_result == 1))
d_ba <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate( # this is what changes for slugging and OBP
ba_bin = case_when(
pa_outcome %in% c(
"Single",
"Double",
"Home Run"
) ~ 1,
pa_outcome %in% c(
"Flyout",
"Strikeout",
"Groundout",
"Lineout"
) ~ 0,
pa_outcome == "Walk" ~ NA_real_,
TRUE ~ NA_real_
# do this for all
)
)
d_ba_collapsed <- d_ba %>%
group_by(pitch_group) %>%
summarize(
mean_ba = mean(ba_bin, na.rm = T)
)
View(d_ba)
View(d_ba)
View(d_ba_collapsed)
unique(pa_outcome)
unique(d_ba$pa_outcome)
d_slg <- d %>%
group_by(outing_id, pa_id) %>%
summarize(no_result = sum(!is.na(bip_result)) + sum(!is.na(non_bip_result)))
assertthat::assert_that(all(d_ba$no_result == 1))
d_slg <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate( # this is what changes for slugging and OBP
slg_bin = case_when(
pa_outcome %in% c("Single") ~ 1,
pa_outcome %in% c("Double") ~ 2,
pa_outcome %in% c("Triple") ~ 3,
pa_outcome %in% c("Home Run") ~ 4,
pa_outcome %in% "Walk" ~ NA_real_,
TRUE ~ NA_real_
# do this for all
)
)
d_slg_collapsed <- d_slg %>%
group_by(pitch_group) %>%
summarize(
mean_ba = mean(slg_bin, na.rm = T)
)
View(d_slg_collapsed)
#source("Kishor import.R")
library(tidyverse)
d <- read_csv("../data/tonas_clean.csv")
d <- d %>%
mutate(
strike = case_when(
pitch_result %in% c("Strike Swinging", "Strike Taken", "Foul", "BIP") ~ 1,
TRUE ~ 0
)) %>%
group_by(outing_id) %>%
mutate(
pitch_num_by_outing = row_number()) %>%
ungroup() %>%
mutate(
pitch_group_by_ten = (pitch_num_by_outing %/% 10) + 1,
pg_b = pitch_group_by_ten * 10,
pg_a = pg_b - 9,
pitch_group = str_c(pg_a, pg_b, sep = "-")
)
dd <- d %>%
group_by(pitch_group) %>%
summarize(
strike_pct = mean(strike),
count = n(),
)
pitcher <- unique(d$pitcher)
ggplot(dd) +
geom_point(aes(x = pitch_group, y = strike_pct)) +
geom_line(aes(x = pitch_group, y = strike_pct, group = 1)) +
scale_y_continuous(labels = scales::percent) +
labs(title = paste(pitcher, "Strike % by Pitch Count"), y = "Strike Percentage", x = "Pitch Number") +
theme_bw()
d <- d %>%
mutate(
strikeout = case_when(
non_bip_result %in% c("Strikeout") ~ 1,
TRUE ~ 0
)) %>%
mutate(
walk = case_when(
non_bip_result %in% c("Walk") ~ 1,
TRUE ~ 0
))
dk <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(strikeout),
Name = "strikeout"
)
dbb <- d %>%
group_by(pitch_group) %>%
summarize(
Outcome = sum(walk),
Name = "walk"
)
ddd <- rbind(dk, dbb)
ggplot(ddd, aes(x = pitch_group, y = Outcome, group = Name, color = Name)) +
geom_point() +
geom_line()
d_ba <- d %>%
group_by(outing_id, pa_id) %>%
summarize(no_result = sum(!is.na(bip_result)) + sum(!is.na(non_bip_result)))
assertthat::assert_that(all(d_ba$no_result == 1))
d_ba <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate( # this is what changes for slugging and OBP
ba_bin = case_when(
pa_outcome %in% c(
"Single",
"Double",
"Home Run"
) ~ 1,
pa_outcome %in% c(
"Flyout",
"Strikeout",
"Groundout",
"Lineout",
"Lined Into Double Play"
) ~ 0,
pa_outcome == "Walk" ~ NA_real_,
TRUE ~ NA_real_
# do this for all
)
)
d_ba_collapsed <- d_ba %>%
group_by(pitch_group) %>%
summarize(
mean_ba = mean(ba_bin, na.rm = T)
)
View(d_ba)
d_slg <- d %>%
group_by(outing_id, pa_id) %>%
summarize(no_result = sum(!is.na(bip_result)) + sum(!is.na(non_bip_result)))
View(d_slg)
d_slg <- d %>%
group_by(outing_id, pa_id) %>%
summarize(no_result = sum(!is.na(bip_result)) + sum(!is.na(non_bip_result)))
assertthat::assert_that(all(d_ba$no_result == 1))
d_slg <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate( # this is what changes for slugging and OBP
slg_bin = case_when(
pa_outcome %in% c("Single") ~ 1,
pa_outcome %in% c("Double") ~ 2,
pa_outcome %in% c("Triple") ~ 3,
pa_outcome %in% c("Home Run") ~ 4,
pa_outcome %in% "Walk" ~ NA_real_,
TRUE ~ NA_real_
# do this for all
)
)
d_slg_collapsed <- d_slg %>%
group_by(pitch_group) %>%
summarize(
mean_ba = mean(slg_bin, na.rm = T)
)
View(d_slg_collapsed)
View(d_slg)
d_slg <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate(
single_bin = case_when(
pa_outcome %in% c("Single") ~ 1,
TRUE ~ NA_real_
# do this for all
)
)
d_slg <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate(
single_bin = case_when(
pa_outcome %in% c("Single") ~ 1,
TRUE ~ NA_real_
# do this for all
)
)
sum(d_slig$single_bin)
sum(d_slg$single_bin)
d_slg <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate(
single_bin = case_when(
pa_outcome %in% c("Single") ~ 1,
TRUE ~ 0
# do this for all
)
)
sum(d_slg$single_bin)
d_slg <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate(
single_bin = case_when(
pa_outcome %in% c("Single") ~ 1,
TRUE ~ 0),
double_bin = case_when(
pa_outcome %in% c("Double") ~ 1,
TRUE ~ 0),
triple_bin = case_when(
pa_outcome %in% c("Triple") ~ 1,
TRUE ~ 0),
hr_bin = case_when(
pa_outcome %in% c("Home Run") ~ 1,
TRUE ~ 0)
)
d_slg_collapsed <- d_slg %>%
group_by(pitch_group) %>%
summarize(
total_bases = sum(single_bin) + 2*sum(double_bin) + 3*sum(triple_bin) + 4*sum(hr_bin)
)
View(d_slg_collapsed)
nrow(d_slg)
d_slg_collapsed <- d_slg %>%
group_by(pitch_group) %>%
summarize(
total_bases = sum(single_bin) + 2*sum(double_bin) + 3*sum(triple_bin) + 4*sum(hr_bin),
slg_pct = total_bases/nrow(d_slg)
)
View(d_slg_collapsed)
View(d)
View(d_ba)
View(d_ba_collapsed)
View(d_slg_collapsed)
d_slg_collapsed <- d_slg %>%
group_by(pitch_group) %>%
summarize(
total_bases = sum(single_bin) + 2*sum(double_bin) + 3*sum(triple_bin) + 4*sum(hr_bin),
at_bats = nrow()
)
d_slg_collapsed <- d_slg %>%
group_by(pitch_group) %>%
summarize(
total_bases = sum(single_bin) + 2*sum(double_bin) + 3*sum(triple_bin) + 4*sum(hr_bin),
at_bats = nrow(this)
)
View(d_slg_collapsed)
d_slg <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate(
single_bin = case_when(
pa_outcome %in% c("Single") ~ 1,
TRUE ~ 0),
double_bin = case_when(
pa_outcome %in% c("Double") ~ 1,
TRUE ~ 0),
triple_bin = case_when(
pa_outcome %in% c("Triple") ~ 1,
TRUE ~ 0),
hr_bin = case_when(
pa_outcome %in% c("Home Run") ~ 1,
TRUE ~ 0),
index = 1
)
d_slg_collapsed <- d_slg %>%
group_by(pitch_group) %>%
summarize(
total_bases = sum(single_bin) + 2*sum(double_bin) + 3*sum(triple_bin) + 4*sum(hr_bin),
at_bats = sum(index)
)
View(d_slg_collapsed)
d_slg <- d %>%
filter(!is.na(bip_result) | !is.na(non_bip_result)) %>%
group_by(pitch_group, outing_id, pa_id) %>%
summarize(
pa_outcome = if_else(!is.na(bip_result), bip_result, non_bip_result)
) %>%
mutate(
single_bin = case_when(
pa_outcome %in% c("Single") ~ 1,
TRUE ~ 0),
double_bin = case_when(
pa_outcome %in% c("Double") ~ 1,
TRUE ~ 0),
triple_bin = case_when(
pa_outcome %in% c("Triple") ~ 1,
TRUE ~ 0),
hr_bin = case_when(
pa_outcome %in% c("Home Run") ~ 1,
TRUE ~ 0),
at_bat = case_when(
pa_outcome %in% c("Walk", "Sacrifice Bunt") ~ 0,
TRUE ~ 1)
)
d_slg_collapsed <- d_slg %>%
group_by(pitch_group) %>%
summarize(
total_bases = sum(single_bin) + 2*sum(double_bin) + 3*sum(triple_bin) + 4*sum(hr_bin),
at_bats = sum(index)
)
View(d_slg_collapsed)
d_slg_collapsed <- d_slg %>%
group_by(pitch_group) %>%
summarize(
total_bases = sum(single_bin) + 2*sum(double_bin) + 3*sum(triple_bin) + 4*sum(hr_bin),
at_bats = sum(at_bat)
)
View(d_slg_collapsed)
d_slg_collapsed <- d_slg %>%
group_by(pitch_group) %>%
summarize(
total_bases = sum(single_bin) + 2*sum(double_bin) + 3*sum(triple_bin) + 4*sum(hr_bin),
at_bats = sum(at_bat),
slg_pct = total_bases/at_bats
)
View(d_slg_collapsed)
